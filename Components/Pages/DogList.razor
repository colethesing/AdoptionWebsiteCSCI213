@page "/DogList"
@using System.Text
@using AdoptionWebsiteTest.Models
@using AdoptionWebsiteTest.Components.Pages
@using Microsoft.Data.SqlClient;
@using System;
@using System.Data;
@using System.Data.SqlClient;
@using System.Collections;

<h3>List of Available Dogs</h3>

@if (dogList == null)
//necessary check to prevent an error related to null values
{
    <p><em>Loading...</em></p>
}
else
{
    //creates the table and the values that go into the table
<table class="table">
    <thead>
        <tr>
            <th>Photo</th>
            <th>Name</th>
            <th>Breed</th>
            <th>Age</th>
            <th>Description</th>
            <th>More Info</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var dog in dogList)
        {
            <tr>
                <td></td>
                <td>@dog.name</td>
                <td>@dog.breed</td>
                <td>@dog.age</td>
                <td>@dog.description</td>
                <td></td>
            </tr>
        }
    </tbody>
</table>
}
@code {

    private dogListClass[]? dogList;
    SqlConnection connectionString = new SqlConnection("Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=DogDatabase;Integrated Security=True;Connect Timeout=30;Encrypt=False;Trust Server Certificate=False;Application Intent=ReadWrite;Multi Subnet Failover=False");
    protected override async Task OnInitializedAsync()
    {
        if (connectionString.State != ConnectionState.Open)
        {
            connectionString.Close();
            connectionString.Open();
        }
        // Simulate asynchronous loading to demonstrate streaming rendering
        await Task.Delay(500);

        // These variables represent the values in the table. They can be changed to change the values in the table;

        String nameQuery = "select dogName from DOG where ID = @incrementDogID";
        String breedQuery = "select dogBreed from DOG where ID = @incrementDogID";
        String ageQuery = "select dogAge from DOG where ID = @incrementDogID";
        String descriptionQuery = "select dogDescription from DOG where ID = @incrementDogID";
        String photoQuery = "select dogPhoto from DOG where ID = @incrementDogID";
        String countQuery = "select count(*) from dog";
        int count = 0;
        SqlCommand cmdCount = new SqlCommand(countQuery, connectionString);
        count = (int)cmdCount.ExecuteScalar();
        ArrayList nameList = new ArrayList();
        ArrayList breedList = new ArrayList();
        ArrayList ageList = new ArrayList();
        ArrayList descriptionList = new ArrayList();
        ArrayList photoList = new ArrayList();
        for(int i = 0; i < count; i++)
        {
            
            SqlCommand nameCommand = new SqlCommand(nameQuery, connectionString);
            SqlCommand breedCommand = new SqlCommand(breedQuery, connectionString);
            SqlCommand ageCommand = new SqlCommand(ageQuery, connectionString);
            SqlCommand descriptionCommand = new SqlCommand(descriptionQuery, connectionString);
            SqlCommand photoCommand = new SqlCommand(photoQuery, connectionString);

            nameCommand.Parameters.AddWithValue("@incrementDogID", 1 + i);
            breedCommand.Parameters.AddWithValue("@incrementDogID", 1 + i);
            ageCommand.Parameters.AddWithValue("@incrementDogID", 1 + i);
            descriptionCommand.Parameters.AddWithValue("@incrementDogID", 1 + i);
            photoCommand.Parameters.AddWithValue("@incrementDogID", 1 + i);

            nameList.Add(nameCommand.ExecuteScalar());
            breedList.Add(nameCommand.ExecuteScalar());
            ageList.Add(nameCommand.ExecuteScalar());
            descriptionList.Add(nameCommand.ExecuteScalar());
            photoList.Add(nameCommand.ExecuteScalar());

        }


        var tableName  = new SqlCommand(nameQuery, connectionString);
        var tableBreed = new SqlCommand (breedQuery, connectionString);
        var tableAge = new SqlCommand(ageQuery, connectionString);
        var tableDescription = new SqlCommand(descriptionQuery, connectionString);
        int increment = 0;
        dogList = Enumerable.Range(1, count).Select(index => new dogListClass
            {
                name = nameList[0].ToString(),
                breed = breedList[0].ToString(),
                age = Convert.ToInt32(ageList[0]),
                description = descriptionList[0].ToString()
            }).ToArray();
            
    }

    // set and get for each variable in the class
    private class dogListClass
    {
        public string name { get; set; }
        public int age { get; set; }
        public string description { get; set; }
        public string breed { get; set; }
    }
}

